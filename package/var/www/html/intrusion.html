<!doctype html>
<meta charset="utf-8"/>
<script>

//Global map for ip -> data
var mapper = new Map();

function loadFile(filePath,elemID){

   //read in encrypted data
   var result = null;
   var xmlhttp = new XMLHttpRequest();
   xmlhttp.open("GET", filePath, false);
   xmlhttp.send();
   if (xmlhttp.status==200){
      result = xmlhttp.responseText;
   }

   //decrypt encrypted data
   /*var newStr = new String(result.length);
   for(var i = 0; i < result.length; i++){
   // console.log(result[i]);
    var x = result[i].charCodeAt() - 48;
    //console.log(x);
    var plus5 = x - 5 + 48;
    //console.log(String.fromCharCode(plus5));
    //newStr[i] = result[i].replace(result[i], String.fromCharCode(plus5));
    newStr +  String.fromCharCode(plus5);
    console.log(newStr[i]);
   }
console.log(newStr.toString());*/
   if(filePath == "ipTable"){
      
      //parse string into array and cut the end  
      var arr = result.split("\n");
      arr.splice(-1,1);

      for(var i = 0; i < arr.length; i++){
         var opt = document.createElement('option');
         opt.value = i;
         opt.text = arr[i].toString();
         document.getElementById('seleBox').options.add(opt);
      }
      console.log(arr);

   }

   if(filePath == "dataTable"){

      var arr = result.split("\n");

      for(var i = 0; i < arr.length; i++){

         mapper.set(i,arr[i]);

      }
      console.log(mapper);

   }
   elemID.toString();
   document.getElementById(elemID).value = result;

}

function clickEvent(){

   var index = document.getElementById('seleBox').value;
   //console.log(mapper.get(parseInt(index)));
   var textMap = mapper.get(parseInt(index));
   document.getElementById('tbox2').value = textMap;
}

</script>

<title>Intrusion Detection</title>
<style>
  * {
   box-sizing: border-box; 
  }
  body {
    margin: 5;
  }
  #main {
    display: flex;
    min-height: calc(100vh - 40vh);
  }
  #main > article {
    flex: 1;
  }
  #main > nav{
    flex: 0 0 20vw;
    background: beige;
  }
  #main > nav {
    order: -1;
  }
  header, footer, article, nav{
    padding: 2em;
  }
  header{
    font-size: 24pt;
    font-weight: normal;
    background: grey;
    height: 5vh;
  }
</style>
<body>
  <header>Intrusion Detection Logs:</header>
  <div id="main">
    <div>
    <nav>Intruding IP:</nav>
    <!--<object height="100%" width="100%" type="text/plain" data="yaboi" border="1" style="border-color:grey;"></object> 
    <textarea rows="12" cols="25" id="tbox1"></textarea>-->
    <select cols="20" id="seleBox" onChange="clickEvent()"></select>
    <script>loadFile("ipTable","tbox1")</script>
    </div>
    <div>
    <article>Data Traffic:</article>
   <!-- <object height="100%" width="100%" type="text/plain" data="dataTable" border="1" style="border-color:grey;"></object>-->
   <textarea border="2" rows="25" cols="25" id="tbox2"></textarea>
   <script>loadFile("dataTable","tbox2")</script>
    </div>
   <div>
   <article>Block IP:</article>
   <textbox>If you would like to block any of the address you see on this list. Please visit /etc/untrustedIPs and add them to the list.</textbox>
   </div> 
  </div>
</body>
